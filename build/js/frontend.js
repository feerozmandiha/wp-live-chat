!function(e,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.frontend=s():e.frontend=s()}(self,()=>(function(e,s){"use strict";if(void 0!==s){if(void 0!==e.wpLiveChat){class t{constructor(e){this.frontend=e,this.currentStep="welcome",this.userData={},this.requiresInput=!0,this.inputType="general_message",this.inputPlaceholder="",this.inputHint="",console.log("âœ… ConversationFlowManager created")}async processUserInput(e){try{const t=await s.ajax({url:this.frontend.ajaxurl,type:"POST",data:{action:"process_conversation_step",nonce:this.frontend.nonce,session_id:this.frontend.sessionId,input:e,step:this.currentStep},timeout:1e4});if(t.success){const e=t.data;return this.currentStep=e.next_step,this.userData=e.user_data,this.requiresInput=e.requires_input,this.inputType=e.input_type,this.inputPlaceholder=e.input_placeholder,this.inputHint=e.input_hint,this.updateInputUI(),!0}return!1}catch(e){return console.error("Error:",e),!1}}updateInputUI(){const e=this.frontend.$textarea;e&&e.attr("placeholder",this.inputPlaceholder||this.frontend.strings.typeMessage||"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯...")}}class n{constructor(e={}){this.ajaxurl=e.ajaxurl||"/wp-admin/admin-ajax.php",this.nonce=e.nonce||"",this.pusherKey=e.pusherKey||"",this.pusherCluster=e.pusherCluster||"",this.sessionId=e.sessionId||"chat_"+this._uuid(),this.currentUser=e.userData||e.currentUser||{},this.strings=e.strings||{},this.conversationFlowData=e.conversationFlow||{},this.pusher=null,this.isHistoryLoading=!1,this.historyLoaded=!1,this.messageHistory=[],this.selectors={container:"#wp-live-chat-container",messages:".chat-messages",toggle:".chat-toggle",widget:".chat-widget",userForm:".user-info-form",phoneInput:"#wlch-phone",nameInput:"#wlch-name",saveInfoBtn:"#wlch-save-info",skipInfoBtn:"#wlch-skip-info",inputArea:".chat-input-area",textarea:"#wlch-textarea",counter:"#wlch-counter",sendBtn:"#wlch-send-btn",closeBtn:".chat-close",notificationBadge:".notification-badge",typingIndicator:".typing-indicator"},this.maxChars=500,this.connected=!1,this.unreadCount=0,this.isTyping=!1,this.lastMessageId=null,this.messageQueue=new Set,this.messageHistory=[],this.isSending=!1,this.conversationFlow=null,this.conversationFlowData=e.conversationFlow||{},this.init()}init(){this.cacheElements(),this.$container.addClass("position-bottom-left"),this.bindUI(),this.loadHistoryAndScroll(),this.showUserForms(),this.initPusher(),this.updateCounter(),this.setConnectedStatus("connecting"),this.initConversationFlow()}initConversationFlow(){if(console.log("Initializing conversation flow..."),void 0===t)return console.error("ConversationFlowManager is not defined!"),void this.loadConversationFlowDynamically();try{this.conversationFlow=new t(this),console.log("âœ… ConversationFlowManager initialized successfully",this.conversationFlow),this.loadCurrentConversationStep()}catch(e){console.error("âŒ Failed to initialize ConversationFlowManager:",e),this.setupFallbackConversation()}}loadConversationFlowDynamically(){console.log("Attempting to load conversation flow dynamically..."),setTimeout(()=>{void 0!==t?this.initConversationFlow():(console.warn("ConversationFlowManager still not available, using fallback"),this.setupFallbackConversation())},2e3)}async loadCurrentConversationStep(){if(this.conversationFlow)try{const e=await s.ajax({url:this.ajaxurl,type:"POST",data:{action:"get_conversation_step",nonce:this.nonce,session_id:this.sessionId},timeout:5e3,dataType:"json"});if(e.success){const s=e.data;this.conversationFlow&&(this.conversationFlow.currentStep=s.current_step,this.conversationFlow.userData=s.user_data||{},this.conversationFlow.requiresInput=s.requires_input,this.conversationFlow.inputType=s.input_type||"general_message",this.conversationFlow.inputPlaceholder=s.input_placeholder||"",this.conversationFlow.inputHint=s.input_hint||"",this.conversationFlow.updateInputUI()),s.message&&!this.hasDisplayedSystemMessage(s.message)&&this.appendMessage({id:"sys_"+Date.now(),message:s.message,user_name:"Ø³ÛŒØ³ØªÙ…",timestamp:(new Date).toISOString(),type:"system"}),console.log("âœ… Current conversation step loaded:",s)}}catch(e){console.error("âŒ Error loading conversation step:",e),this.conversationFlow&&(this.conversationFlow.currentStep="welcome",this.conversationFlow.updateInputUI())}else console.warn("Conversation flow not initialized, skipping step load")}hasDisplayedSystemMessage(e){const t=this.$messages.find(".system-message .message-content p");for(let n=0;n<t.length;n++)if(s(t[n]).text().includes(e.substring(0,50)))return!0;return!1}setupFallbackConversation(){console.log("Using fallback conversation flow"),this.$textarea&&this.$textarea.attr("placeholder",this.strings.typeMessage||"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯...")}cacheElements(){this.$container=s(this.selectors.container),this.$messages=this.$container.find(this.selectors.messages),this.$toggle=this.$container.find(this.selectors.toggle),this.$widget=this.$container.find(this.selectors.widget),this.$userForm=this.$container.find(this.selectors.userForm),this.$phoneInput=this.$container.find(this.selectors.phoneInput),this.$nameInput=this.$container.find(this.selectors.nameInput),this.$saveInfoBtn=this.$container.find(this.selectors.saveInfoBtn),this.$skipInfoBtn=this.$container.find(this.selectors.skipInfoBtn),this.$inputArea=this.$container.find(this.selectors.inputArea),this.$textarea=this.$container.find(this.selectors.textarea),this.$counter=this.$container.find(this.selectors.counter),this.$sendBtn=this.$container.find(this.selectors.sendBtn),this.$closeBtn=this.$container.find(this.selectors.closeBtn),this.$notif=this.$container.find(this.selectors.notificationBadge),this.$typingIndicator=this.$container.find(this.selectors.typingIndicator)}openChat(){this.isOpening||(this.isOpening=!0,this.$container.removeClass("wp-live-chat-hidden"),this.unreadCount=0,this.updateNotificationBadge(0),this.historyLoaded||this.isHistoryLoading||this.historyLoadAttempted?setTimeout(()=>{this.scrollToBottom(!0,!0),this.$textarea.focus()},100):(this.historyLoadAttempted=!0,this.isHistoryLoading=!0,this.loadHistoryAndScroll()),this.sendChatOpenedEvent(),setTimeout(()=>{this.isOpening=!1},500))}loadHistoryAndScroll(){this.historyLoaded||s.ajax({url:this.ajaxurl,type:"POST",data:{action:"get_chat_history",nonce:this.nonce,session_id:this.sessionId,limit:50},timeout:15e3}).done(e=>{e.success&&(this.historyLoaded=!0,this.renderHistory(e.data))}).fail(e=>{console.error("Failed to load history:",e),this.loadFromLocalStorage()}).always(()=>{this.isHistoryLoading=!1})}closeChat(){this.$container.addClass("wp-live-chat-hidden"),this.sendChatClosedEvent()}sendChatOpenedEvent(){if(this.pusher&&this.connected)try{const e=this.pusher.channel(`private-chat-${this.sessionId}`);e&&e.trigger("client-chat-opened",{user_id:this.currentUser.id||0,user_name:this.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±",timestamp:(new Date).toISOString()})}catch(e){}}sendChatClosedEvent(){if(this.pusher&&this.connected)try{const e=this.pusher.channel(`private-chat-${this.sessionId}`);e&&e.trigger("client-chat-closed",{user_id:this.currentUser.id||0,timestamp:(new Date).toISOString()})}catch(e){}}initPusher(){if(this.pusher){try{this.pusher.disconnect()}catch(e){}this.pusher=null}const e={cluster:this.pusherCluster,forceTLS:!0,authEndpoint:this.ajaxurl,auth:{params:{action:"pusher_auth",nonce:this.nonce,session_id:this.sessionId}},activityTimeout:6e4,pongTimeout:15e3,wsHost:"ws-"+this.pusherCluster+".pusher.com",disableStats:!0,enabledTransports:["ws","wss"]};if(this.pusher=new Pusher(this.pusherKey,e),!this.pusherKey||"undefined"==typeof Pusher)return this.setConnectedStatus("offline"),this.showAlert("Ø³Ø±ÙˆÛŒØ³ Ú†Øª Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª","error",5e3),void console.error("Pusher key or library not found");try{"undefined"!=typeof window&&"localhost"!==window.location.hostname&&(Pusher.logToConsole=!1),this.pusher=new Pusher(this.pusherKey,{cluster:this.pusherCluster||"mt1",forceTLS:!0,authEndpoint:this.ajaxurl,auth:{params:{action:"pusher_auth",nonce:this.nonce,session_id:this.sessionId,user_name:this.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±",timestamp:Date.now()},headers:{"X-WP-Nonce":this.nonce}},enabledTransports:["ws","wss"],disabledTransports:["xhr_streaming","xhr_polling"],activityTimeout:12e4,pongTimeout:3e4,disableStats:!0,wsHost:"ws-"+(this.pusherCluster||"mt1")+".pusher.com",wssPort:443,wsPort:80}),this.pusher.connection.bind("state_change",e=>{switch(console.log("Pusher connection state changed:",e.previous,"->",e.current),e.current){case"connected":this.setConnectedStatus("online"),this.retryCount=0,this.connected=!0,this.showAlert("Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ø±Ø§Ø± Ø´Ø¯","success",3e3),this.sendConnectionEvent("connected");break;case"connecting":this.setConnectedStatus("connecting"),this.connected=!1,console.log("Connecting to Pusher...");break;case"disconnected":this.setConnectedStatus("offline"),this.connected=!1,console.log("Disconnected from Pusher"),this.attemptReconnect();break;case"failed":this.setConnectedStatus("offline"),this.connected=!1,this.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ú†Øª","error",5e3),console.error("Pusher connection failed"),this.attemptReconnect();break;case"unavailable":this.setConnectedStatus("offline"),this.connected=!1,console.warn("Pusher service unavailable"),this.initPollingFallback()}}),this.pusher.connection.bind("error",e=>{console.error("Pusher connection error:",e),("WebSocketError"===e.type||e.error)&&this.attemptReconnect()});const e=`private-chat-${this.sessionId}`,s=this.pusher.subscribe(e);s.bind("pusher:subscription_succeeded",()=>{console.log(`Successfully subscribed to channel: ${e}`),this.sendSubscriptionEvent("succeeded",e)}),s.bind("pusher:subscription_error",s=>{console.error(`Subscription error for channel ${e}:`,s),setTimeout(()=>{this.pusher&&"connected"===this.pusher.connection.state&&(console.log(`Retrying subscription to ${e}`),this.pusher.subscribe(e))},5e3)}),s.bind("new-message",e=>{console.log("New message received via Pusher:",e),this.onIncomingMessage(e)}),s.bind("admin-typing",()=>{console.log("Admin typing indicator received"),this.showTypingIndicator()}),s.bind("admin-stopped-typing",()=>{console.log("Admin stopped typing indicator received"),this.hideTypingIndicator()}),s.bind("message-read",e=>{console.log("Message read by admin:",e),this.markMessageAsRead(e.message_id)});const t=this.pusher.subscribe("admin-notifications");t.bind("admin-connected",e=>{console.log("Admin connected notification:",e),this.showAlert("Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† Ø´Ø¯","info",3e3),this.adminOnline=!0,this.updateAdminStatus(!0)}),t.bind("admin-disconnected",e=>{console.log("Admin disconnected notification:",e),this.showAlert("Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¢ÙÙ„Ø§ÛŒÙ† Ø´Ø¯","warning",3e3),this.adminOnline=!1,this.updateAdminStatus(!1)}),t.bind("user-info-completed",e=>{console.log("User info completed:",e)});const n=this.pusher.subscribe("presence-chat");n.bind("pusher:member_added",e=>{console.log("Member added to chat:",e)}),n.bind("pusher:member_removed",e=>{console.log("Member removed from chat:",e)}),setInterval(()=>{if(this.pusher&&"connected"===this.pusher.connection.state)try{this.pusher.connection.send_event("pusher:ping",{})}catch(e){console.log("Keep-alive ping failed, reconnecting..."),this.initPusher()}},45e3),this.pusherChannel=s,this.pusherAdminChannel=t,this.pusherPresenceChannel=n,console.log("Pusher initialized successfully")}catch(e){console.error("Error initializing Pusher:",e),this.setConnectedStatus("offline"),this.connected=!1;let s="Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ú†Øª";e.message&&e.message.includes("app key")?s="ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØªØµØ§Ù„ Ú†Øª Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª":e.message&&e.message.includes("network")&&(s="Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú†Øª"),this.showAlert(s,"error",5e3),setTimeout(()=>this.attemptReconnect(),1e4)}}attemptReconnect(){if(this.retryCount>=this.maxRetries)return void this.initPollingFallback();this.retryCount++;const e=Math.min(1e3*Math.pow(2,this.retryCount),3e4);setTimeout(()=>{!this.connected&&this.pusherKey&&(this.pusher&&this.pusher.disconnect(),this.initPusher())},e)}initPollingFallback(){console.log("Initializing polling fallback"),this.pusherEnabled=!1,this.setConnectedStatus("offline"),this.pollingInterval=setInterval(()=>{!this.pusherEnabled&&this.sessionId&&this.pollForNewMessages()},1e4),this.showAlert("Ø³ÛŒØ³ØªÙ… Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ† Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¨Ø§ ØªØ§Ø®ÛŒØ± Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.","warning",5e3)}pollForNewMessages(){this.isPolling||(this.isPolling=!0,s.ajax({url:this.ajaxurl,type:"POST",data:{action:"poll_messages",nonce:this.nonce,session_id:this.sessionId,last_message_id:this.lastMessageId},timeout:8e3,dataType:"json"}).done(e=>{e.success&&e.data&&e.data.messages&&(e.data.messages.forEach(e=>{this.onIncomingMessage(e)}),e.data.messages.length>0&&(this.lastMessageId=e.data.messages[e.data.messages.length-1].id))}).fail(e=>{console.error("Polling error:",e)}).always(()=>{this.isPolling=!1}))}sendConnectionEvent(e){s.ajax({url:this.ajaxurl,type:"POST",data:{action:"update_connection_status",nonce:this.nonce,session_id:this.sessionId,status:e,timestamp:Date.now()},timeout:5e3}).fail(e=>{console.warn("Failed to send connection event:",e)})}sendSubscriptionEvent(e,t){s.ajax({url:this.ajaxurl,type:"POST",data:{action:"log_subscription",nonce:this.nonce,session_id:this.sessionId,channel:t,status:e,timestamp:Date.now()},timeout:5e3}).fail(e=>{console.warn("Failed to send subscription event:",e)})}sendPing(){if(this.pusher&&this.pusherChannel)try{this.pusherChannel.trigger("client-ping",{session_id:this.sessionId,timestamp:Date.now()})}catch(e){console.warn("Error sending ping:",e)}}cleanupPusher(){if(console.log("Cleaning up Pusher resources"),this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.pusher){try{this.pusherChannel&&this.pusher.unsubscribe(this.pusherChannel.name),this.pusherAdminChannel&&this.pusher.unsubscribe(this.pusherAdminChannel.name),this.pusherPresenceChannel&&this.pusher.unsubscribe(this.pusherPresenceChannel.name),this.pusher.disconnect()}catch(e){console.warn("Error during Pusher cleanup:",e)}this.pusher=null}this.connected=!1,this.pusherEnabled=!1,this.retryCount=0}checkConnectionHealth(){if(!this.pusher||!this.pusher.connection)return{status:"disconnected",details:"No Pusher instance"};const e=this.pusher.connection.state,s=this.pusher.connection.lastActivity,t=Date.now(),n=s?t-s:1/0;return{status:e,connected:"connected"===e,inactiveFor:n>6e4?Math.floor(n/1e3)+" seconds":"active",channels:this.pusher.allChannels().map(e=>e.name),retryCount:this.retryCount,pollingActive:!!this.pollingInterval,pusherEnabled:this.pusherEnabled}}onIncomingMessage(e){if(console.log("Incoming message from Pusher:",e),!e||!e.message&&!e.message_content&&""===!e.message)return void console.error("Invalid payload:",e);if("system"===e.type&&(!e.message||""===e.message.trim()))return void console.log("Empty system message ignored");const s=(e.message||e.message_content||"").trim();if(!s)return void console.error("Empty message:",e);const t=e.id||this.generateMessageId(s,e.timestamp);if(this.messageQueue.has(t))return void console.log("Duplicate message ignored (by ID):",t);if(this.isDuplicateMessage(s,e.timestamp))return void console.log("Duplicate message ignored (by content):",s.substring(0,50));const n=this.findOptimisticIdForMessage(s);if(n){console.log("Replacing optimistic message:",n,"with real message:",t);const s=this.$messages.find(`[data-message-id="${n}"]`);s.length?(s.removeClass("sending").addClass("sent"),s.find(".sending-status").text("âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯"),setTimeout(()=>{s.fadeOut(300,()=>{s.remove(),this.messageQueue.delete(n),this.addMessageToChat({...e,id:t})})},1e3)):this.addMessageToChat({...e,id:t})}else this.addMessageToChat({...e,id:t})}generateMessageId(e,s){return`msg_${s?new Date(s).getTime():Date.now()}_${this.hashCode(e)}`}hashCode(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s&=s;return Math.abs(s).toString(16).substring(0,8)}isDuplicateMessage(e,t){const n=e.trim();if(!n)return!1;const i=t?new Date(t).getTime():Date.now();for(const e of this.messageHistory)if(e.text===n){const s=new Date(e.timestamp).getTime();if(Math.abs(i-s)<5e3)return!0}const o=this.$messages.find('.message:not([data-message-id^="temp_"])');for(let e=0;e<o.length;e++){const t=s(o[e]);if(t.find(".message-content p").text().trim()===n){const e=t.data("timestamp");if(!e)return!0;{const s=new Date(e).getTime();if(Math.abs(i-s)<5e3)return!0}}}return!1}addMessageToChat(e){e.id&&this.messageQueue.add(e.id),this.$messages.find(".welcome-message").length&&this.$messages.find(".welcome-message").remove(),this.hideTypingIndicator();const s=this._renderMessage(e);return this.messageHistory.push({id:e.id,text:e.message||e.message_content,timestamp:e.timestamp||(new Date).toISOString()}),this.messageHistory.length>50&&this.messageHistory.shift(),this.scrollToBottom(),this.$container.hasClass("wp-live-chat-hidden")&&"admin"===e.type&&(this.unreadCount++,this.updateNotificationBadge(this.unreadCount),"Notification"in window&&"granted"===Notification.permission&&new Notification("Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†",{body:e.message||e.message_content,icon:"/wp-content/plugins/wp-live-chat/assets/images/icon.png"})),s}findOptimisticIdForMessage(e){const t=e.trim();let n=null;return this.$messages.find('.message[data-message-id^="temp_"]').each(function(){const e=s(this);if(e.find(".message-content p").text().replace("â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...","").replace("âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯","").replace("âœ… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ (Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø² Ø³Ø±ÙˆØ±...)","").trim()===t)return n=e.data("message-id"),!1}),n}appendMessage(e){return!(e.id&&this.messageQueue.has(e.id)||(e.id&&this.messageQueue.add(e.id),this.$messages.find(".welcome-message").length&&this.$messages.find(".welcome-message").remove(),this.hideTypingIndicator(),this._renderMessage(e),this.scrollToBottom(),0))}_renderMessage(e){if(!this.$messages)return null;const t={id:"",message:"",user_name:"Ú©Ø§Ø±Ø¨Ø±",timestamp:(new Date).toISOString(),type:"user",status:"sent",...e},n=this._formatTime(t.timestamp);let i="user-message",o=t.user_name,a="",r="";switch(t.type){case"admin":i="admin-message",o="ğŸ‘¨â€ğŸ’¼ Ù¾Ø´ØªÛŒØ¨Ø§Ù†",r="slide-in-left";break;case"system":i="system-message",o="âš™ï¸ Ø³ÛŒØ³ØªÙ…",r="slide-in-left";break;case"user":o="ğŸ‘¤ "+o,r="slide-in-right"}switch(t.status){case"sending":a='<span class="message-status sending">â³</span>',i+=" sending";break;case"sent":a='<span class="message-status sent">âœ“</span>',i+=" sent";break;case"delivered":a='<span class="message-status delivered">âœ“âœ“</span>';break;case"read":a='<span class="message-status read">ğŸ‘ï¸</span>';break;case"error":a='<span class="message-status error">âŒ</span>',i+=" error"}let c=this._escapeHtml(t.message||t.message_content||"");c=this._addEmojis(c),c=this._autoLink(c);const h=s(`\n        <div class="message ${i} ${r}" data-message-id="${this._escapeAttr(t.id)}" data-timestamp="${this._escapeAttr(t.timestamp)}">\n        <div class="message-header">\n            <div class="message-sender">${o}</div>\n            <div class="message-time">${n} ${a}</div>\n        </div>\n        <div class="message-content">\n            <p>${c}</p>\n        </div>\n        </div>\n    `);return h.hide().appendTo(this.$messages).fadeIn(300),setTimeout(()=>{h.removeClass(r)},300),h}_autoLink(e){return e.replace(/(https?:\/\/[^\s]+)/g,function(e){return'<a href="'+e+'" target="_blank" rel="noopener noreferrer" style="color: #007cba; text-decoration: underline;">'+e+"</a>"})}sendMessage(e){if(!e||!e.trim())return;if(this.isSending)return void this.showAlert("Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...","info",2e3);const s=e.trim(),t="temp_"+Date.now()+"_"+this.hashCode(s);this.conversationFlow&&this.conversationFlow.requiresInput?this.processMessageWithFlow(s,t):this.processMessageDirectly(s,t)}processMessageDirectly(e,s){this.isSending=!0,this.$sendBtn.prop("disabled",!0).html('<span class="send-icon">â³</span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...');const t={id:s,message:e,user_name:this.currentUser.name||this.currentUser.display_name||"Ø´Ù…Ø§",timestamp:(new Date).toISOString(),type:"user",status:"sending"},n=this._renderMessage(t);this.messageQueue.add(s),this.$textarea.val(""),this.updateCounter(),this.scrollToBottom(),this.sendToServer(e,s,n)}sendToServer(e,t,n){const i=this;s.ajax({url:this.ajaxurl,type:"POST",data:{action:"send_chat_message",nonce:this.nonce,session_id:this.sessionId,message:e,step:this.conversationFlow?this.conversationFlow.getCurrentStep():"general_message",temp_id:t},dataType:"json",timeout:1e4}).done(function(e){e&&e.success?(i.showAlert("Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯","success",3e3),n&&(n.removeClass("sending").addClass("sent"),n.find(".message-status").text("âœ“").removeClass("sending").addClass("sent"),n.find(".sending-status").remove()),e.data.flow_result&&(i.conversationFlow.currentStep=e.data.flow_result.next_step,i.conversationFlow.updateInputPlaceholder())):i.handleSendError(n,t,e?e.data:"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…")}).fail(function(e,s,o){i.handleSendError(n,t,"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±"),console.error("Send message failed:",s,o)}).always(function(){i.isSending=!1,i.$sendBtn.prop("disabled",!1).html('<span class="send-icon">âœ‰ï¸</span> Ø§Ø±Ø³Ø§Ù„')})}async processMessageWithFlow(e,t){if(console.log("ğŸ”„ processMessageWithFlow called:",{text:e.substring(0,50),step:this.conversationFlow?this.conversationFlow.getCurrentStep():"unknown",messageId:t}),!this.conversationFlow)return console.error("âŒ Conversation flow not initialized"),void this.showAlert("Ø³ÛŒØ³ØªÙ… Ú†Øª Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª","error",3e3);this.isSending=!0,this.$sendBtn.prop("disabled",!0).html('<span class="send-icon">â³</span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...');const n={id:t,message:e,user_name:this.currentUser.name||this.currentUser.display_name||"Ø´Ù…Ø§",timestamp:(new Date).toISOString(),type:"user",status:"sending"},i=this._renderMessage(n);this.messageQueue.add(t),this.$textarea.val(""),this.updateCounter(),this.scrollToBottom();try{console.log("ğŸ“¤ Sending to process_conversation_step...");const n=await s.ajax({url:this.ajaxurl,type:"POST",data:{action:"process_conversation_step",nonce:this.nonce,session_id:this.sessionId,input:e,step:this.conversationFlow.getCurrentStep()},dataType:"json",timeout:3e4});if(console.log("ğŸ“¥ Response received:",n),n&&n.success){const e=n.data;console.log("âœ… Flow processed successfully:",{next_step:e.next_step,requires_input:e.requires_input,input_type:e.input_type}),i&&(i.removeClass("sending").addClass("sent"),i.find(".message-status").text("âœ“").removeClass("sending").addClass("sent")),this.conversationFlow&&(this.conversationFlow.currentStep=e.next_step||e.state.current_step,this.conversationFlow.userData=e.user_data||e.state.user_data||{},this.conversationFlow.requiresInput=e.requires_input||e.state.requires_input,this.conversationFlow.inputType=e.input_type||e.state.input_type,this.conversationFlow.inputPlaceholder=e.input_placeholder||e.state.input_placeholder,this.conversationFlow.inputHint=e.input_hint||e.state.input_hint,console.log("ğŸ”„ Conversation flow updated in frontend:",{step:this.conversationFlow.currentStep,inputType:this.conversationFlow.inputType,requiresInput:this.conversationFlow.requiresInput}),this.conversationFlow.updateInputUI(),e.message&&""!==e.message.trim()&&(console.log("ğŸ“¢ System message to show:",e.message),this.shouldShowSystemMessage(e.message)&&(this.appendMessage({id:"sys_"+Date.now(),message:e.message,user_name:"Ø³ÛŒØ³ØªÙ…",timestamp:(new Date).toISOString(),type:"system"}),this.markSystemMessageShown(e.message))),this.conversationFlow.requiresInput||"chat_active"!==this.conversationFlow.currentStep||setTimeout(()=>{this.$textarea.focus()},100)),this.showAlert("Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯","success",2e3),console.log("ğŸ¯ Final flow state:",{step:this.conversationFlow?this.conversationFlow.getCurrentStep():"unknown",canSendNext:!!this.conversationFlow&&this.conversationFlow.requiresInput,inputType:this.conversationFlow?this.conversationFlow.getInputType():"unknown"})}else{console.error("âŒ Server error:",n);const e=n&&n.data&&n.data.message?n.data.message:"Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…";this.handleSendError(i,t,e)}}catch(e){console.error("âŒ AJAX error:",e);let s="Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±";"timeout"===e.statusText&&(s="Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯."),this.handleSendError(i,t,s)}finally{this.isSending=!1,this.$sendBtn.prop("disabled",!1).html('<span class="send-icon">âœ‰ï¸</span> Ø§Ø±Ø³Ø§Ù„'),this.conversationFlow&&this.conversationFlow.requiresInput&&setTimeout(()=>{this.$textarea.focus()},100)}}markSystemMessageShown(e){const s="shown_system_msg_"+this.hashCode(e);sessionStorage.setItem(s,"true")}shouldShowSystemMessage(e){const s="shown_system_msg_"+this.hashCode(e);return!sessionStorage.getItem(s)}handleFlowTimeout(e,s,t){console.log("â° Flow timeout handler called"),e&&(e.addClass("message-error"),e.find(".message-content p").append('<small style="display:block; color:#ffb900; margin-top:5px; font-style:italic;">âš ï¸ Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø·ÙˆÙ„ Ú©Ø´ÛŒØ¯ØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯</small>')),this.messageQueue.delete(s),this.showAlert("Ø²Ù…Ø§Ù† Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø·ÙˆÙ„ Ú©Ø´ÛŒØ¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯","warning",5e3),this.isSending=!1,this.$sendBtn.prop("disabled",!1).html('<span class="send-icon">âœ‰ï¸</span> Ø§Ø±Ø³Ø§Ù„'),this.$textarea.focus()}updateInputPlaceholder(){const e=this.frontend.$textarea;if(!e)return;let s="";switch(this.inputType){case"phone":s=this.frontend.strings.phonePlaceholder||"Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„...";break;case"name":s=this.frontend.strings.namePlaceholder||"Ù†Ø§Ù… ÛŒØ§ Ø´Ø±Ú©Øª...";break;default:s=this.frontend.strings.typeMessage||"Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯..."}e.attr("placeholder",s),this.updateInputUI()}handleSendError(e,s,t){e&&(e.addClass("message-error"),e.find(".message-content p").append('<small style="display:block; color:#dc3232; margin-top:5px; font-style:italic;">âš ï¸ '+t+"</small>")),this.messageQueue.delete(s),this.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…: "+t,"error",5e3),this.$textarea.focus()}sendTypingEvent(e){if(this.pusher&&this.connected)try{const s=this.pusher.channel("private-chat-"+this.sessionId);s&&("typing"===e?s.trigger("client-user-typing",{user_id:this.currentUser.id||0,user_name:this.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±",timestamp:Date.now()}):"stopped"===e&&s.trigger("client-user-stopped-typing",{user_id:this.currentUser.id||0,timestamp:Date.now()}))}catch(s){console.log("Typing event error:",s),this.sendTypingViaAjax(e)}}sendTypingViaAjax(e){s.ajax({url:this.ajaxurl,type:"POST",data:{action:"wp_live_chat_typing",nonce:this.nonce,session_id:this.sessionId,status:e,user_name:this.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±"},timeout:3e3}).fail(function(){})}showTypingIndicator(){this.$typingIndicator&&(this.$typingIndicator.stop(!0,!0).fadeIn(300),this.scrollToBottom())}hideTypingIndicator(){this.$typingIndicator&&this.$typingIndicator.stop(!0,!0).fadeOut(300)}showUserForms(){if(this.currentUser&&(this.currentUser.phone||this.currentUser.name))return this.showInputArea(!0),this.showUserInfoForm(!1),void this.showAlert("Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ "+(this.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±"),"info",3e3);this.showInputArea(!1),this.showUserInfoForm(!0)}showInputArea(e){this.$inputArea&&(e?(this.$inputArea.slideDown(300),setTimeout(()=>this.$textarea.focus(),350)):this.$inputArea.slideUp(300))}showUserInfoForm(e){this.$userForm&&(e?(this.$userForm.slideDown(400),setTimeout(()=>this.$phoneInput.focus(),450)):this.$userForm.slideUp(300))}loadHistory(){const e=this;this.$messages.html(`\n        <div class="welcome-message">\n          <p>${this._escapeHtml(this.strings.welcome||"Ø³Ù„Ø§Ù…! Ø¨Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯.")}</p>\n        </div>\n        <div class="loading-history" style="text-align:center; padding:20px; color:#666;">\n          <div class="spinner"></div>\n          <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡...</p>\n        </div>\n      `),s.ajax({url:this.ajaxurl,type:"POST",data:{action:"get_chat_history",nonce:this.nonce,session_id:this.sessionId},dataType:"json",timeout:1e4}).done(function(s){e.$messages.find(".loading-history").remove(),s&&s.success&&Array.isArray(s.data)?0===s.data.length||(e.$messages.find(".welcome-message").remove(),s.data.forEach(function(s){e.messageQueue.has(s.id)||e.appendMessage({id:s.id,message:s.message_content,user_name:s.user_name,timestamp:s.created_at,type:s.message_type})})):e.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡","error")}).fail(function(){e.$messages.find(".loading-history").remove(),e.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡","error")})}bindUI(){const e=this;let t;s(document).on("click",this.selectors.toggle,function(){e.$container.hasClass("wp-live-chat-hidden")?(e.$container.removeClass("wp-live-chat-hidden"),e.unreadCount=0,e.updateNotificationBadge(0),setTimeout(()=>{0===e.messageHistory.length?e.loadHistoryAndScroll():e.scrollToBottom(!0),e.$textarea.focus()},100)):e.$container.addClass("wp-live-chat-hidden")}),s(document).on("click",this.selectors.closeBtn,function(){e.$container.addClass("wp-live-chat-hidden")}),s(document).on("click",this.selectors.container+" .chat-widget",function(t){s(t.target).closest(".chat-messages, .chat-header").length||setTimeout(()=>e.$textarea.focus(),50)}),s(document).on("click",this.selectors.saveInfoBtn,function(){const t=e.$phoneInput.val().trim(),n=e.$nameInput.val().trim();t||n?(s(this).prop("disabled",!0).html('<span class="btn-icon">â³</span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...'),s.ajax({url:e.ajaxurl,type:"POST",data:{action:"save_user_info",nonce:e.nonce,session_id:e.sessionId,phone:t,name:n,company:""},dataType:"json",timeout:1e4}).done(function(i){i&&i.success?(e.currentUser.phone=t||e.currentUser.phone,e.currentUser.name=n||e.currentUser.name,e.showUserForms(),e.showInputArea(!0),e.showAlert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯","success",3e3),s.post(e.ajaxurl,{action:"send_welcome_message",nonce:e.nonce,session_id:e.sessionId,user_name:e.currentUser.name})):e.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª","error",4e3)}).fail(function(){e.showAlert("Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±","error",4e3)}).always(function(){s(this).prop("disabled",!1).html('<span class="btn-icon">âœ“</span> Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª')})):e.showAlert("Ù„Ø·ÙØ§Ù‹ Ø´Ù…Ø§Ø±Ù‡ ÛŒØ§ Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯","error",3e3)}),s(document).on("click",this.selectors.skipInfoBtn,function(){e.currentUser=e.currentUser||{},e.currentUser.name=e.currentUser.name||"Ú©Ø§Ø±Ø¨Ø±_"+Math.floor(9e3*Math.random()+1e3),e.showUserForms(),e.showInputArea(!0),e.showAlert("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ø¹Ø¯Ø§Ù‹ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªÚ©Ù…ÛŒÙ„ Ú©Ù†ÛŒØ¯","info",3e3)}),s(document).on("input",this.selectors.textarea,function(){e.updateCounter();const t=s(this).val().trim();!e.isTyping&&t.length>0?(e.isTyping=!0,e.sendTypingEvent("typing")):e.isTyping&&0===t.length&&(e.isTyping=!1,e.sendTypingEvent("stopped"))}),s(document).on("keyup",this.selectors.textarea,function(){clearTimeout(t),t=setTimeout(function(){e.isTyping&&(e.isTyping=!1,e.sendTypingEvent("stopped"))},1e3)}),s(document).on("click",this.selectors.sendBtn,function(){const s=e.$textarea.val().trim();e.sendMessage(s)}),s(document).on("keydown",this.selectors.textarea,function(t){if("Enter"===t.key&&!t.shiftKey){t.preventDefault();const n=s(this).val().trim();n&&!e.$sendBtn.prop("disabled")&&e.sendMessage(n)}}),s(document).on("animationend",this.selectors.inputArea,function(){s(this).is(":visible")&&e.$textarea.focus()}),s(document).on("input",this.selectors.textarea,function(){if(e.updateCounter(),e.conversationFlow&&e.conversationFlow.isPhoneStep()){const e=s(this).val().trim();e&&!/^09[0-9]{0,9}$/.test(e)?s(this).addClass("input-error"):s(this).removeClass("input-error")}const t=s(this).val().trim();!e.isTyping&&t.length>0?(e.isTyping=!0,e.sendTypingEvent("typing")):e.isTyping&&0===t.length&&(e.isTyping=!1,e.sendTypingEvent("stopped"))})}showAlert(e,t="info",n=5e3){s(".alert-message").remove();const i={success:"âœ…",error:"âŒ",info:"â„¹ï¸",warning:"âš ï¸"},o=s(`\n        <div class="alert-message alert-${t}">\n          <span class="alert-icon">${i[t]||i.info}</span>\n          <div class="alert-content">\n            <div class="alert-title">${"success"===t?"Ù…ÙˆÙÙ‚ÛŒØª":"error"===t?"Ø®Ø·Ø§":"ØªÙˆØ¬Ù‡"}</div>\n            <div class="alert-text">${this._escapeHtml(e)}</div>\n          </div>\n          <button class="alert-close">&times;</button>\n        </div>\n      `);return s("body").append(o),o.find(".alert-close").on("click",function(){o.fadeOut(300,function(){s(this).remove()})}),n>0&&setTimeout(function(){o.is(":visible")&&o.fadeOut(300,function(){s(this).remove()})},n),o}setConnectedStatus(e){this.connected="online"===e;const s=this.$container.find(".status-dot"),t=this.$container.find(".status-text");s.removeClass("connecting online offline").addClass(e),t.text({online:"Ø¢Ù†Ù„Ø§ÛŒÙ†",offline:"Ø¢ÙÙ„Ø§ÛŒÙ†",connecting:"Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„..."}[e]||e)}updateCounter(){if(!this.$textarea||!this.$counter||!this.$sendBtn)return;const e=(this.$textarea.val()||"").length,s=this.maxChars-e;this.$counter.text(`${e}/${this.maxChars}`),0===e?(this.$sendBtn.prop("disabled",!0),this.$counter.removeClass("exceeded warning")):e>this.maxChars?(this.$sendBtn.prop("disabled",!0),this.$counter.addClass("exceeded")):(this.$sendBtn.prop("disabled",!1),this.$counter.removeClass("exceeded"),s<=50?this.$counter.addClass("warning"):this.$counter.removeClass("warning"))}updateNotificationBadge(e){this.unreadCount=e,this.$notif&&(!e||e<=0?this.$notif.hide():this.$notif.text(e>9?"9+":e).show())}scrollToBottom(e=!1,s=!1){if(!this.$messages||!this.$messages.length)return;const t=this.$messages[0].scrollHeight,n=this.$messages.height();!s&&t-(this.$messages.scrollTop()+n)>200||(e?this.$messages.scrollTop(t):this.$messages.stop().animate({scrollTop:t},300))}_formatTime(e){if(!e)return"";try{let s;if(s="string"==typeof e?e.includes("T")?new Date(e):new Date(e.replace(" ","T")):new Date(e),!isNaN(s.getTime()))return s.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit",hour12:!1})}catch(e){}return e}_addEmojis(e){const s={":)":"ğŸ˜Š",":-)":"ğŸ˜Š",":(":"ğŸ˜",":-(":"ğŸ˜",":D":"ğŸ˜ƒ",":-D":"ğŸ˜ƒ",";)":"ğŸ˜‰",";-)":"ğŸ˜‰",":P":"ğŸ˜›",":-P":"ğŸ˜›",":O":"ğŸ˜®",":-O":"ğŸ˜®",":*":"ğŸ˜˜",":-*":"ğŸ˜˜","<3":"â¤ï¸",":heart:":"â¤ï¸",":like:":"ğŸ‘",":thumbsup:":"ğŸ‘",":thanks:":"ğŸ™",":ok:":"ğŸ‘Œ","?:":"â“"};let t=e;for(const[e,n]of Object.entries(s))t=t.replace(new RegExp(this._escapeRegex(e),"g"),n);return t}_escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}_escapeHtml(e){return s("<div/>").text(e||"").html()}_escapeAttr(e){return String(e||"").replace(/["'<>]/g,"")}_uuid(){return"xxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)})}}console.log("WP Live Chat Frontend script loaded"),console.log("Window.wpLiveChat:",window.wpLiveChat),console.log("ConversationFlowManager defined:",void 0!==t),void 0===t&&(console.warn("ConversationFlowManager is not defined, loading conversation-flow.js might have failed"),window.ConversationFlowManager=class{constructor(e){console.log("Using fallback ConversationFlowManager"),this.frontend=e,this.currentStep="welcome",this.requiresInput=!0,this.inputType="general_message"}processUserInput(e){return Promise.resolve(!0)}updateInputUI(){this.frontend.$textarea&&this.frontend.$textarea.attr("placeholder","Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯...")}}),s(function(){try{const t=new n(e.wpLiveChat||{});e._wpLiveChatFrontend=t,s("<style>").text("\n                  /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ conversation flow */\n                  .input-hint {\n                      display: block;\n                      font-size: 11px;\n                      color: #666;\n                      margin-top: 5px;\n                      margin-bottom: 8px;\n                      padding: 4px 8px;\n                      background: #f8f9fa;\n                      border-radius: 4px;\n                      border-right: 3px solid #007cba;\n                      animation: fadeIn 0.3s ease;\n                  }\n                  \n                  .input-error-message {\n                      display: none;\n                      font-size: 11px;\n                      color: #dc3232;\n                      margin-top: 5px;\n                      margin-bottom: 8px;\n                      padding: 6px 10px;\n                      background: #fff5f5;\n                      border-radius: 4px;\n                      border: 1px solid #ffcccc;\n                      animation: shake 0.3s ease;\n                  }\n                  \n                  .input-error {\n                      border-color: #dc3232 !important;\n                      box-shadow: 0 0 0 1px rgba(220, 50, 50, 0.2) !important;\n                      animation: pulseError 0.5s ease;\n                  }\n                  \n                  @keyframes fadeIn {\n                      from { opacity: 0; transform: translateY(-5px); }\n                      to { opacity: 1; transform: translateY(0); }\n                  }\n                  \n                  @keyframes shake {\n                      0%, 100% { transform: translateX(0); }\n                      25% { transform: translateX(-5px); }\n                      75% { transform: translateX(5px); }\n                  }\n                  \n                  @keyframes pulseError {\n                      0%, 100% { border-color: #dc3232; }\n                      50% { border-color: #ff6b6b; }\n                  }\n                  \n                  /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ø§ÛŒ Ø§Ù†ÙˆØ§Ø¹ input */\n                  .phone-input-hint {\n                      border-right-color: #25D366;\n                  }\n                  \n                  .name-input-hint {\n                      border-right-color: #ffb900;\n                  }\n                  \n                  .general-input-hint {\n                      border-right-color: #007cba;\n                  }\n                  \n                  /* loading spinner */\n                  .loading-history .spinner {\n                      display: inline-block;\n                      width: 40px;\n                      height: 40px;\n                      border: 3px solid #f3f3f3;\n                      border-top: 3px solid #007cba;\n                      border-radius: 50%;\n                      animation: spin 1s linear infinite;\n                  }\n                  \n                  @keyframes spin {\n                      0% { transform: rotate(0deg); }\n                      100% { transform: rotate(360deg); }\n                  }\n                  \n                  .message-error {\n                      opacity: 0.7;\n                      border-color: #dc3232 !important;\n                  }\n              ").appendTo("head")}catch(e){console.error("WPLiveChatFrontend init error",e)}})}}else console&&console.error&&console.error("jQuery required by WPLiveChatFrontend")}(window,jQuery),{}));